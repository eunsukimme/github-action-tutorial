## Github Action CD 워크플로우 수정

- main 브랜치에 새로운 커밋이 푸시되면 사용자는 캐시된 콘텐츠가 아닌 새로운 콘텐츠를 볼 수 있어야 한다
- CD 워크플로우에서 AWS CLI로 CloudFront에 저장된 캐시를 invalidate 시켜주어야 한다
- 즉, CD 워크플로우의 AWS CLI User에 CloudFront에 접근할 수 있는 policy를 추가하고 invlidate step 을 추가해야 한다

---

## AWS IAM 유저에 CloudFront 수정 정책 추가 - 실습

CD 워크플로우에서 S3에 접근하는 주체가 CloudFront에도 접근할 수 있도록 Policy를 추가합니다

<!-- fragments-start -->

<figure>
  <img src="/slides/images/cloudfront-iam-hands-on/1.png" />
  <figcaption>
    이전에 생성한 User 페이지에서 Add Permissions 버튼 클릭
  </figcaption>
</figure>

<figure>
  <img src="/slides/images/cloudfront-iam-hands-on/2.png" />
  <figcaption>
    Attach existing policies directly 클릭 후 cloudFront 를 검색하여
    CloudFrontFullAccess 롤을 선택한다
  </figcaption>
</figure>

<!-- fragments-end -->

---

## CD 워크플로우 수정

`.github/workflows/cd.yaml` 의 `deploy` 잡의 맨 마지막으로 다음과 같은 step을 추가합니다

```yaml
name: Continuous Deployment
on:
  push:
    branches:
      - main
jobs:
  build:
    # ...

  deploy:
    # ...
    - name: Invalidate CloudFront Cache
      run: aws cloudfront create-invalidation --distribution-id ${{ secrets.AWS_CLOUDFRONT_DISTRIBUTION_ID }} --paths "/*"
```

<span class="comment">
  여기서는 Github Secret에 cloudfront distribution 아이디를
  AWS_CLOUDFRONT_DISTRIBUTION_ID란 이름으로 추가했습니다
</span>

---

## 최종 테스트
